# Nginx logrotate configuration
# This file can be customized via environment variables

/var/log/nginx/*.log {
    # Rotate daily by default (configurable via LOGROTATE_FREQUENCY)
    daily
    
    # Keep 30 days of logs by default (configurable via LOGROTATE_KEEP_DAYS)
    rotate 30
    
    # Compress rotated logs (configurable via LOGROTATE_COMPRESS)
    compress
    delaycompress
    
    # Don't rotate if log file is missing (configurable via LOGROTATE_MISSINGOK)
    missingok
    
    # Don't rotate empty logs (configurable via LOGROTATE_NOTIFEMPTY)
    notifempty
    
    # Create new log files with these permissions
    create 644 www-data www-data
    
    # Shared scripts for pre and post rotation
    sharedscripts
    
    # Pre-rotation script: signal nginx to reopen log files
    prerotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
    
    # Post-rotation script: run custom archive script if configured
    postrotate
        # Run the logrotate manager script for archiving/remote transfer
        if [ -x /usr/bin/logrotate-manager.sh ]; then
            /usr/bin/logrotate-manager.sh postrotate
        fi
    endscript
}


